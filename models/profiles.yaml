models:
  - name: users_stitcher
    model_type: id_stitcher
    model_spec:
      validity_time: 24h # 1 day
      entity_key: user
      edge_sources:
        - from: inputs/rsIdentifies
        - from: inputs/rsTracks
        - from: inputs/rsPages
  # Remove the section below, if you don't want to generate a feature table
  - name: users
    model_type: feature_table_model
    model_spec:
      validity_time: 24h # 1 day
      entity_key: user
      features:
        - payments_received
        - payments_executed
        - total_withdrawn_amount
        - total_capital_approved
        - propensity_to_apply_for_loan
        - propensity_to_churn
        - most_recent_email
        - total_sessions_to_date
var_groups:
  - name: user_vars
    entity_key: user
    vars:
      - entity_var:
          name: payments_received
          from: inputs/rsIdentifies
          select: uniform(1, 100, random())
          description: Number of payments received
      - entity_var:
          name: payments_executed
          from: inputs/rsIdentifies
          select: uniform(1, 100, random())
          description: Number of payments sent
      - entity_var:
          name: total_withdrawn_amount
          from: inputs/rsIdentifies
          select: uniform(1, 1000, random())
          description: Amount withdrawn
      - entity_var:
          name: total_capital_approved
          from: inputs/rsIdentifies
          select: uniform(0, 10000, random())
          description: Capital loan amount approved
      - entity_var:
          name: propensity_to_apply_for_loan
          from: inputs/rsIdentifies
          select: right(random(), 2)/100
          description: Likelihood of the user to apply for a loan
      - entity_var:
          name: propensity_to_churn
          from: inputs/rsIdentifies
          select: right(random(), 2)/100
          description: Likelihood of the user to churn
      - entity_var:
          name: total_sessions_to_date
          from: models/rsTracksUnionPages
          select: count(distinct context_session_id)
          where: context_session_id is not null
          description: Total individual sessions created till date.
      - entity_var:
          name: most_recent_email
          from: inputs/rsIdentifies
          select: first_value(email)
          window:
            order_by:
              - timestamp desc
          where: email is not null and email!=''
          description: Email associated to the user
